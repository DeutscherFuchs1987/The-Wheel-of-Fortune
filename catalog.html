<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–æ–≤ üé¨</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(145deg, #1a1e2f 0%, #2a2f44 100%);
            min-height: 100vh;
            padding: 20px;
            color: #eaeef2;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(120deg, #a7c0e7, #d6b0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-buttons {
            display: flex;
            gap: 15px;
        }
        .nav-btn {
            background: #283153;
            color: white;
            text-decoration: none;
            padding: 12px 30px;
            border-radius: 40px;
            font-weight: 600;
            border-bottom: 4px solid #0e142b;
            transition: 0.1s linear;
        }
        .nav-btn.active {
            background: #5f4bb6;
            border-bottom-color: #352b66;
        }
        .nav-btn:hover {
            transform: translateY(-2px);
        }
        
        /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .filter-bar {
            background: #1a1f33;
            border-radius: 40px;
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 1px solid #3d435b;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 15px;
        }
        .filter-title {
            color: #a3b7f0;
            font-weight: 600;
            margin-right: 10px;
        }
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            flex: 1;
        }
        .filter-btn {
            background: #262d4a;
            border: 1px solid #48537e;
            color: #cbd5ff;
            padding: 8px 20px;
            border-radius: 40px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-btn:hover {
            background: #323d62;
            transform: translateY(-2px);
        }
        .filter-btn.active {
            background: #5f4bb6;
            color: white;
            border-color: #a990ff;
            box-shadow: 0 0 10px rgba(169, 144, 255, 0.5);
        }
        
        .controls-panel {
            background: #1a1f33;
            border-radius: 40px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #3d435b;
        }
        
        /* –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ */
        .search-container {
            position: relative;
            width: 100%;
        }
        .search-input {
            width: 100%;
            background: #010214;
            border: 2px solid #49537c;
            border-radius: 60px;
            padding: 15px 25px;
            font-size: 1.1rem;
            color: white;
            outline: none;
            transition: all 0.2s;
        }
        .search-input:focus {
            border-color: #7f8bc0;
            box-shadow: 0 0 0 3px rgba(127, 139, 192, 0.3);
        }
        .search-input::placeholder {
            color: #6b729b;
        }
        
        /* –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞ */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1f33;
            border: 2px solid #49537c;
            border-top: none;
            border-radius: 0 0 30px 30px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            display: none;
        }
        .search-results.active {
            display: block;
        }
        .result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #3d435b;
            transition: background 0.2s;
        }
        .result-item:hover {
            background: #283153;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-poster {
            width: 50px;
            height: 70px;
            background-size: cover;
            background-position: center;
            background-color: #2a2f44;
            border-radius: 8px;
            flex-shrink: 0;
        }
        .result-poster.no-poster {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #6b729b;
        }
        .result-info {
            flex: 1;
        }
        .result-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            margin-bottom: 4px;
        }
        .result-meta {
            display: flex;
            gap: 15px;
            color: #a3b7f0;
            font-size: 0.9rem;
        }
        .result-rating {
            background: #ffd966;
            color: #1a1e2f;
            padding: 2px 10px;
            border-radius: 20px;
            font-weight: 600;
        }
        .result-type {
            background: #303a60;
            padding: 2px 10px;
            border-radius: 20px;
        }
        
        /* –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .card {
            background: #191f33dd;
            backdrop-filter: blur(8px);
            border-radius: 30px;
            overflow: hidden;
            border: 1px solid #50587e;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 30px rgba(0,0,0,0.5);
            border-color: #7f8bc0;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ "–í –ø—Ä–æ—Ü–µ—Å—Å–µ" */
        .card.in-progress {
            border: 3px solid #ffd966;
            box-shadow: 0 0 20px rgba(255, 217, 102, 0.5);
            background: #1f2542;
            order: -1; /* –î–ª—è CSS Grid —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ */
        }
        .card.in-progress .rating-badge {
            background: #ffd966;
            border-color: #ffaa00;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ */
        .card-buttons {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .card:hover .card-buttons {
            opacity: 1;
        }
        .delete-card {
            width: 36px;
            height: 36px;
            background: #ff6b8b;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .delete-card:hover {
            background: #ff4757;
            transform: scale(1.1);
        }
        .in-progress-btn {
            width: 36px;
            height: 36px;
            background: #ffd966;
            border: none;
            border-radius: 50%;
            color: #1a1e2f;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .in-progress-btn.active {
            background: #ffaa00;
            box-shadow: 0 0 15px #ffaa00;
        }
        .in-progress-btn:hover {
            transform: scale(1.1);
        }
        .watched-btn {
            width: 36px;
            height: 36px;
            background: #4CAF50;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .watched-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }
        
        .poster {
            height: 300px;
            background-size: cover;
            background-position: center;
            position: relative;
            background-color: #2a2f44;
        }
        .no-poster {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2a2f44, #1a1e2f);
            color: #6b729b;
            font-size: 3rem;
        }
        .rating-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ffd966;
            color: #1a1e2f;
            font-weight: 700;
            font-size: 1.2rem;
            padding: 8px 15px;
            border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 2px solid #ffb347;
        }
        .rating-badge.none {
            background: #4a4f6e;
            color: #cbd5ff;
            border-color: #6b729b;
        }
        .card-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #fff;
            line-height: 1.3;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ */
        .type-selector {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            justify-content: center;
        }
        .type-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #50587e;
            background: #262d4a;
            color: #cbd5ff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .type-btn:hover {
            transform: translateY(-2px);
            background: #323d62;
        }
        .type-btn.active {
            background: #5f4bb6;
            border-color: #a990ff;
            box-shadow: 0 0 10px rgba(169, 144, 255, 0.5);
        }
        
        .card-meta {
            color: #a3b7f0;
            font-size: 0.95rem;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .rating-details {
            margin-top: auto;
            background: #0f1322cc;
            border-radius: 20px;
            padding: 12px;
            font-size: 0.9rem;
        }
        .rating-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .rating-label {
            color: #a3b7f0;
        }
        .rating-value {
            color: #ffd966;
            font-weight: 600;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .stats {
            color: #a3b7f0;
            font-size: 1rem;
            padding: 15px 0 0 0;
            text-align: right;
        }
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px;
            background: #1a1f33;
            border-radius: 40px;
            color: #a3b7f0;
            font-size: 1.2rem;
        }
        .empty-state span {
            font-size: 4rem;
            display: block;
            margin-bottom: 20px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #a3b7f0;
        }
        .error-message {
            color: #ff8a8a;
            background: #3d1e2b;
            padding: 15px 25px;
            border-radius: 40px;
            margin: 20px 0;
            display: none;
        }
        .success-message {
            color: #a0ffa0;
            background: #1e3a2a;
            padding: 10px 20px;
            border-radius: 40px;
            display: none;
            margin: 10px 0;
        }
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: stretch;
            }
            .nav-buttons {
                justify-content: center;
            }
            .projects-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ –ù–ê–® –ö–ê–¢–ê–õ–û–ì</h1>
            <div class="nav-buttons">
                <a href="index.html" class="nav-btn">üé° –ö–æ–ª–µ—Å–æ</a>
                <a href="catalog.html" class="nav-btn active">üìö –ö–∞—Ç–∞–ª–æ–≥</a>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É -->
        <div class="filter-bar">
            <span class="filter-title">üìå –§–∏–ª—å—Ç—Ä:</span>
            <div class="filter-buttons" id="filterButtons">
                <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                <button class="filter-btn" data-filter="–§–∏–ª—å–º">üé¨ –§–∏–ª—å–º—ã</button>
                <button class="filter-btn" data-filter="–°–µ—Ä–∏–∞–ª">üì∫ –°–µ—Ä–∏–∞–ª—ã</button>
                <button class="filter-btn" data-filter="–ú—É–ª—å—Ç—Ñ–∏–ª—å–º">üñçÔ∏è –ú—É–ª—å—Ç—Ñ–∏–ª—å–º—ã</button>
                <button class="filter-btn" data-filter="–ê–Ω–∏–º–µ">üáØüáµ –ê–Ω–∏–º–µ</button>
            </div>
        </div>

        <div class="controls-panel">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" 
                       placeholder="üîç –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤, –∞–Ω–∏–º–µ, —Å–µ—Ä–∏–∞–ª–æ–≤ –Ω–∞ –ö–∏–Ω–æ–ø–æ–∏—Å–∫–µ...">
                <div id="searchResults" class="search-results"></div>
            </div>
            <div class="stats" id="stats"></div>
        </div>

        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <div class="projects-grid" id="projectsGrid"></div>
    </div>

    <script>
        (function(){
            // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
            const KINOPOISK_TOKEN = 'ea7304c3-e5e9-43cd-aca0-f47d1abd3621'; // –¢–≤–æ–π —Ç–æ–∫–µ–Ω
            
            // ========== –•–†–ê–ù–ò–õ–ò–©–ï ==========
            let myProjects = [];
            let currentFilter = 'all'; // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
            
            // ========== DOM –≠–õ–ï–ú–ï–ù–¢–´ ==========
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            const projectsGrid = document.getElementById('projectsGrid');
            const statsDiv = document.getElementById('stats');
            const errorMessageDiv = document.getElementById('errorMessage');
            const successMessageDiv = document.getElementById('successMessage');
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            // ========== –ó–ê–ì–†–£–ó–ö–ê –ü–†–ò –°–¢–ê–†–¢–ï ==========
            loadProjects();
            
            // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ==========
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderProjects();
                    updateStats();
                });
            });
            
            // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
            function showError(text) {
                errorMessageDiv.style.display = 'block';
                errorMessageDiv.textContent = '‚ùå ' + text;
                setTimeout(() => {
                    errorMessageDiv.style.display = 'none';
                }, 3000);
            }
            
            function showSuccess(text) {
                successMessageDiv.style.display = 'block';
                successMessageDiv.textContent = '‚úÖ ' + text;
                setTimeout(() => {
                    successMessageDiv.style.display = 'none';
                }, 2000);
            }
            
            // ========== –†–ê–ë–û–¢–ê –° LOCALSTORAGE ==========
            function saveProjects() {
                localStorage.setItem('myProjects', JSON.stringify(myProjects));
                try {
                    localStorage.setItem('projectsUpdated', Date.now().toString());
                } catch(e) {}
            }
            
            function loadProjects() {
                const saved = localStorage.getItem('myProjects');
                if (saved) {
                    try {
                        myProjects = JSON.parse(saved);
                    } catch(e) {
                        myProjects = [];
                    }
                } else {
                    // –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
                    myProjects = [
                        {
                            id: 'kp_326',
                            title: '–ü–æ–±–µ–≥ –∏–∑ –®–æ—É—à–µ–Ω–∫–∞',
                            title_ru: '–ü–æ–±–µ–≥ –∏–∑ –®–æ—É—à–µ–Ω–∫–∞',
                            year: '1994',
                            rating: '9.1',
                            poster: 'https://kinopoiskapiunofficial.tech/images/posters/kp/326.jpg',
                            type: '–§–∏–ª—å–º',
                            inProgress: false
                        },
                        {
                            id: 'kp_301',
                            title: '–ú–∞—Ç—Ä–∏—Ü–∞',
                            title_ru: '–ú–∞—Ç—Ä–∏—Ü–∞',
                            year: '1999',
                            rating: '8.5',
                            poster: 'https://kinopoiskapiunofficial.tech/images/posters/kp/301.jpg',
                            type: '–§–∏–ª—å–º',
                            inProgress: false
                        }
                    ];
                    saveProjects();
                }
                renderProjects();
                updateStats();
            }
            
            // ========== –£–ú–ù–û–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –¢–ò–ü–ê –ü–û –ñ–ê–ù–†–ê–ú ==========
            function detectTypeByGenres(film) {
                // –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –∂–∞–Ω—Ä–æ–≤ (API –º–æ–∂–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö)
                const genres = (film.genres || []).map(g => (g.genre || g).toLowerCase());
                
                // 1. –ê–ù–ò–ú–ï - –µ—Å–ª–∏ –µ—Å—Ç—å –∂–∞–Ω—Ä "–∞–Ω–∏–º–µ"
                if (genres.includes('–∞–Ω–∏–º–µ')) {
                    return '–ê–Ω–∏–º–µ';
                }
                
                // 2. –ú–£–õ–¨–¢–§–ò–õ–¨–ú - –µ—Å–ª–∏ –µ—Å—Ç—å –∂–∞–Ω—Ä "–º—É–ª—å—Ç—Ñ–∏–ª—å–º" –∏–ª–∏ "–∞–Ω–∏–º–∞—Ü–∏—è"
                if (genres.includes('–º—É–ª—å—Ç—Ñ–∏–ª—å–º') || genres.includes('–∞–Ω–∏–º–∞—Ü–∏—è')) {
                    return '–ú—É–ª—å—Ç—Ñ–∏–ª—å–º';
                }
                
                // 3. –°–ï–†–ò–ê–õ - –ø–æ —Ç–∏–ø—É –∏–∑ API
                if (film.type === 'TV_SERIES' || film.type === 'MINI_SERIES') {
                    return '–°–µ—Ä–∏–∞–ª';
                }
                
                // 4. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –§–ò–õ–¨–ú
                return '–§–∏–ª—å–º';
            }
            
            // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –ü–†–û–ï–ö–¢–ê ==========
            function addProject(film) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç
                if (myProjects.some(p => p.id === 'kp_' + film.filmId)) {
                    showError('–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —É–∂–µ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ');
                    return false;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —á–µ—Ä–µ–∑ —É–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
                const type = detectTypeByGenres(film);
                
                const newProject = {
                    id: 'kp_' + film.filmId,
                    title: film.nameEn || film.nameRu,
                    title_ru: film.nameRu || film.nameEn,
                    year: film.year || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                    rating: film.rating || '‚Äî',
                    poster: film.posterUrlPreview || film.posterUrl || null,
                    type: type,
                    inProgress: false // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
                };
                
                myProjects.push(newProject);
                saveProjects();
                renderProjects();
                updateStats();
                showSuccess(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${newProject.title_ru} (${newProject.type})`);
                return true;
            }
            
            // ========== –£–î–ê–õ–ï–ù–ò–ï –ü–†–û–ï–ö–¢–ê ==========
            function deleteProject(id) {
                myProjects = myProjects.filter(p => p.id !== id);
                saveProjects();
                renderProjects();
                updateStats();
                showSuccess('–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω');
            }
            
            // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê "–í –ü–†–û–¶–ï–°–°–ï" ==========
            function toggleInProgress(id) {
                const project = myProjects.find(p => p.id === id);
                if (project) {
                    project.inProgress = !project.inProgress;
                    saveProjects();
                    renderProjects();
                    updateStats();
                    showSuccess(project.inProgress ? '–ü—Ä–æ–µ–∫—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞' : '–ü—Ä–æ–µ–∫—Ç –≤–æ–∑–≤—Ä–∞—â—ë–Ω –≤ —Å–ø–∏—Å–æ–∫');
                }
            }
            
            // ========== –ó–ê–ì–õ–£–®–ö–ê –î–õ–Ø "–ü–†–û–°–ú–û–¢–†–ï–ù–û" ==========
            function markAsWatched(id) {
                showSuccess('‚ú® –§—É–Ω–∫—Ü–∏—è –æ—Ü–µ–Ω–æ–∫ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ!');
                console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ:', id);
            }
            
            // ========== –°–ú–ï–ù–ê –¢–ò–ü–ê –ü–†–û–ï–ö–¢–ê ==========
            function changeProjectType(projectId, newType) {
                const project = myProjects.find(p => p.id === projectId);
                if (project) {
                    project.type = newType;
                    saveProjects();
                    renderProjects();
                    updateStats();
                    showSuccess(`–¢–∏–ø –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${newType}`);
                }
            }
            
            // ========== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==========
            function updateStats() {
                const total = myProjects.length;
                const inProgress = myProjects.filter(p => p.inProgress).length;
                const types = {};
                myProjects.forEach(p => { types[p.type] = (types[p.type] || 0) + 1; });
                
                let statsText = `üìä –í—Å–µ–≥–æ: ${total}`;
                if (inProgress > 0) statsText += ` | üî• –í –ø—Ä–æ—Ü–µ—Å—Å–µ: ${inProgress}`;
                if (types['–§–∏–ª—å–º']) statsText += ` | üé¨ –§–∏–ª—å–º–æ–≤: ${types['–§–∏–ª—å–º']}`;
                if (types['–°–µ—Ä–∏–∞–ª']) statsText += ` | üì∫ –°–µ—Ä–∏–∞–ª–æ–≤: ${types['–°–µ—Ä–∏–∞–ª']}`;
                if (types['–ú—É–ª—å—Ç—Ñ–∏–ª—å–º']) statsText += ` | üñçÔ∏è –ú—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤: ${types['–ú—É–ª—å—Ç—Ñ–∏–ª—å–º']}`;
                if (types['–ê–Ω–∏–º–µ']) statsText += ` | üáØüáµ –ê–Ω–∏–º–µ: ${types['–ê–Ω–∏–º–µ']}`;
                
                statsDiv.textContent = statsText;
            }
            
            // ========== –ü–û–õ–£–ß–ï–ù–ò–ï –û–¢–§–ò–õ–¨–¢–†–û–í–ê–ù–ù–´–• –ü–†–û–ï–ö–¢–û–í ==========
            function getFilteredProjects() {
                if (currentFilter === 'all') return myProjects;
                return myProjects.filter(p => p.type === currentFilter);
            }
            
            // ========== –û–¢–†–ò–°–û–í–ö–ê –ö–ê–†–¢–û–ß–ï–ö ==========
            function renderProjects() {
                const filtered = getFilteredProjects();
                
                if (filtered.length === 0) {
                    let emptyMessage = '–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤';
                    if (currentFilter !== 'all') {
                        const filterName = Array.from(filterButtons).find(b => b.dataset.filter === currentFilter)?.textContent || '';
                        emptyMessage = `–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´${filterName}¬ª –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤`;
                    }
                    
                    projectsGrid.innerHTML = `
                        <div class="empty-state">
                            <span>üé¨</span>
                            <p>${emptyMessage}</p>
                            <p style="font-size: 1rem; margin-top: 10px; color: #6b729b;">
                                –ù–∞—á–Ω–∏—Ç–µ –∏—Å–∫–∞—Ç—å —Ñ–∏–ª—å–º—ã –≤—ã—à–µ –∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∏—Ö –≤ –∫–∞—Ç–∞–ª–æ–≥
                            </p>
                        </div>
                    `;
                    return;
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ "–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ", –ø–æ—Ç–æ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
                const sorted = [...filtered].sort((a, b) => {
                    if (a.inProgress && !b.inProgress) return -1;
                    if (!a.inProgress && b.inProgress) return 1;
                    return 0;
                });
                
                let html = '';
                sorted.forEach(project => {
                    let posterEmoji = 'üé¨';
                    if (project.type === '–ê–Ω–∏–º–µ') posterEmoji = 'üáØüáµ';
                    else if (project.type === '–°–µ—Ä–∏–∞–ª') posterEmoji = 'üì∫';
                    else if (project.type === '–ú—É–ª—å—Ç—Ñ–∏–ª—å–º') posterEmoji = 'üñçÔ∏è';
                    
                    const posterHtml = project.poster 
                        ? `<div class="poster" style="background-image: url('${project.poster}');">
                             ${project.rating !== '‚Äî' ? `<div class="rating-badge">${project.rating}</div>` : '<div class="rating-badge none">‚Äî</div>'}
                           </div>`
                        : `<div class="poster">
                             <div class="no-poster">${posterEmoji}</div>
                             ${project.rating !== '‚Äî' ? `<div class="rating-badge">${project.rating}</div>` : '<div class="rating-badge none">‚Äî</div>'}
                           </div>`;
                    
                    html += `
                        <div class="card ${project.inProgress ? 'in-progress' : ''}" data-project-id="${project.id}">
                            <div class="card-buttons">
                                <button class="delete-card" onclick="window.deleteProject('${project.id}')" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                                <div style="display: flex; gap: 5px;">
                                    <button class="in-progress-btn ${project.inProgress ? 'active' : ''}" 
                                            onclick="window.toggleInProgress('${project.id}')" 
                                            title="${project.inProgress ? '–£–±—Ä–∞—Ç—å –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞'}">
                                        üî•
                                    </button>
                                    <button class="watched-btn" onclick="window.markAsWatched('${project.id}')" title="–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–º">‚úÖ</button>
                                </div>
                            </div>
                            ${posterHtml}
                            <div class="card-content">
                                <div class="card-title">${project.title_ru || project.title}</div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ -->
                                <div class="type-selector">
                                    <button class="type-btn ${project.type === '–§–∏–ª—å–º' ? 'active' : ''}" 
                                            onclick="window.changeProjectType('${project.id}', '–§–∏–ª—å–º')" 
                                            title="–§–∏–ª—å–º">üé¨</button>
                                    <button class="type-btn ${project.type === '–°–µ—Ä–∏–∞–ª' ? 'active' : ''}" 
                                            onclick="window.changeProjectType('${project.id}', '–°–µ—Ä–∏–∞–ª')" 
                                            title="–°–µ—Ä–∏–∞–ª">üì∫</button>
                                    <button class="type-btn ${project.type === '–ú—É–ª—å—Ç—Ñ–∏–ª—å–º' ? 'active' : ''}" 
                                            onclick="window.changeProjectType('${project.id}', '–ú—É–ª—å—Ç—Ñ–∏–ª—å–º')" 
                                            title="–ú—É–ª—å—Ç—Ñ–∏–ª—å–º">üñçÔ∏è</button>
                                    <button class="type-btn ${project.type === '–ê–Ω–∏–º–µ' ? 'active' : ''}" 
                                            onclick="window.changeProjectType('${project.id}', '–ê–Ω–∏–º–µ')" 
                                            title="–ê–Ω–∏–º–µ">üáØüáµ</button>
                                </div>
                                
                                <div class="card-meta">
                                    <span>üìÖ ${project.year}</span>
                                </div>
                                <div class="rating-details">
                                    <div class="rating-row">
                                        <span class="rating-label">–ö–∏–Ω–æ–ø–æ–∏—Å–∫:</span>
                                        <span class="rating-value">${project.rating}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                projectsGrid.innerHTML = html;
            }
            
            // ========== –ü–û–ò–°–ö –ù–ê –ö–ò–ù–û–ü–û–ò–°–ö–ï ==========
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();
                
                if (query.length < 2) {
                    searchResults.classList.remove('active');
                    return;
                }
                
                searchTimeout = setTimeout(async () => {
                    try {
                        searchResults.innerHTML = '<div class="loading" style="padding:20px; text-align:center;">üîç –ü–æ–∏—Å–∫ –Ω–∞ –ö–∏–Ω–æ–ø–æ–∏—Å–∫–µ...</div>';
                        searchResults.classList.add('active');
                        
                        const response = await fetch(`https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=${encodeURIComponent(query)}`, {
                            headers: {
                                'X-API-KEY': KINOPOISK_TOKEN,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                        
                        const data = await response.json();
                        
                        if (!data.films || data.films.length === 0) {
                            searchResults.innerHTML = '<div style="padding:20px; text-align:center; color:#a3b7f0;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∞ –ö–∏–Ω–æ–ø–æ–∏—Å–∫–µ</div>';
                            return;
                        }
                        
                        let resultsHtml = '';
                        data.films.slice(0, 7).forEach(film => {
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ —É–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞
                            const type = detectTypeByGenres(film);
                            
                            const posterUrl = film.posterUrlPreview || film.posterUrl;
                            
                            resultsHtml += `
                                <div class="result-item" onclick="window.addMovieFromKinopoisk('${encodeURIComponent(JSON.stringify(film).replace(/'/g, "\\'"))}')">
                                    <div class="result-poster" style="background-image: url('${posterUrl || ''}'); background-size: cover; background-position: center;"></div>
                                    <div class="result-info">
                                        <div class="result-title">${film.nameRu || film.nameEn || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                                        <div class="result-meta">
                                            <span>üìÖ ${film.year || '?'}</span>
                                            <span class="result-rating">‚≠ê ${film.rating || '‚Äî'}</span>
                                            <span class="result-type">${type}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        searchResults.innerHTML = resultsHtml;
                        
                    } catch (error) {
                        searchResults.innerHTML = `<div style="padding:20px; text-align:center; color:#ff8a8a;">–û—à–∏–±–∫–∞: ${error.message}</div>`;
                    }
                }, 400);
            });
            
            // ========== –ó–ê–ö–†–´–¢–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ==========
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.classList.remove('active');
                }
            });
            
            // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
            window.addMovieFromKinopoisk = function(encodedFilm) {
                try {
                    const film = JSON.parse(decodeURIComponent(encodedFilm));
                    addProject(film);
                    searchResults.classList.remove('active');
                    searchInput.value = '';
                } catch(e) {
                    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏');
                    console.error(e);
                }
            };
            
            window.deleteProject = function(id) {
                deleteProject(id);
            };
            
            window.toggleInProgress = function(id) {
                toggleInProgress(id);
            };
            
            window.markAsWatched = function(id) {
                markAsWatched(id);
            };
            
            window.changeProjectType = function(id, newType) {
                changeProjectType(id, newType);
            };
            
            // ========== –°–õ–£–®–ê–ï–ú –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ò–ó –ö–û–õ–ï–°–ê ==========
            window.addEventListener('storage', (e) => {
                if (e.key === 'projectsUpdated') {
                    loadProjects();
                }
            });
            
            // ========== –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¢–†–ò–°–û–í–ö–ê ==========
            renderProjects();
            updateStats();
        })();
    </script>
</body>
</html>